/* Database Systems - 158.337 | ASSIGNMENT 01 - Zealandia Driving School 

ALTER SESSION SET NLS_DATE_FORMAT = 'DD/MM/YYYY hh24:mi:ss';

/* DDL - DATA DEFINITION LANGUAGE | SCRIPT FILE */

/* DROP ANY EXISTING SEQUENCES */
DROP SEQUENCE SEQ_INSPECTION_ID;
DROP SEQUENCE SEQ_CLIENT_ID;
DROP SEQUENCE SEQ_REG_NUM;
DROP SEQUENCE SEQ_LESSON_ID;
DROP SEQUENCE SEQ_INTERVIEW_ID;

/*DROP ANY EXISTING TABLES AND CASCADE CONSTRAINTS */


DROP TABLE COMPANY CASCADE CONSTRAINTS;
DROP TABLE JOB CASCADE CONSTRAINTS;
DROP TABLE BRANCH CASCADE CONSTRAINTS;
DROP TABLE EMPLOYEE CASCADE CONSTRAINTS;
DROP TABLE CAR CASCADE CONSTRAINTS;
DROP TABLE INSPECTION CASCADE CONSTRAINTS;
DROP TABLE DEPARTMENT CASCADE CONSTRAINTS;
DROP TABLE CLIENT CASCADE CONSTRAINTS;
DROP TABLE REGISTRATION CASCADE CONSTRAINTS;
DROP TABLE LESSON CASCADE CONSTRAINTS;
DROP TABLE LICENSE CASCADE CONSTRAINTS;
DROP TABLE TEST CASCADE CONSTRAINTS;
DROP TABLE INTERVIEW CASCADE CONSTRAINTS;
DROP TABLE EMP_SAL_HISTORY CASCADE CONSTRAINTS;
DROP TABLE INSTRUCTOR CASCADE CONSTRAINTS;
DROP TABLE MANAGER CASCADE CONSTRAINTS;

/* CREATE TABLE COMPANY */

CREATE TABLE COMPANY (
COMPANY_REG_NUM NUMBER CONSTRAINT COMPANY_REG_NUM_PK PRIMARY KEY,
REGISTERED_NAME VARCHAR(25) CONSTRAINT REG_NAME_UQ UNIQUE CONSTRAINT REG_NAME_NN NOT NULL,
COMPANY_IRD_NUM NUMBER CONSTRAINT IRD_NUM_UQ UNIQUE CONSTRAINT IRD_NUM_NN NOT NULL
);

/* CREATE TABLE JOB */

CREATE TABLE JOB (
JOB_CODE VARCHAR(25) CONSTRAINT JOB_CODE_PK PRIMARY KEY,
JOB_DESCRIPTION VARCHAR(25) CONSTRAINT JOB_DESC_UQ UNIQUE CONSTRAINT JOB_DESC_NN NOT NULL
);

/* CREATE TABLE BRANCH */

CREATE TABLE BRANCH (
BRANCH_ID VARCHAR(25) CONSTRAINT BRANCH_ID_PK PRIMARY KEY,
BRANCH_NAME VARCHAR(30) CONSTRAINT BRANCH_NAME_UQ UNIQUE CONSTRAINT BRANCH_NAME_NN NOT NULL,
BRANCH_ADDRESS_STR_NUM VARCHAR(5) CONSTRAINT BRANCH_ADDRESS_STR_NUM_NN NOT NULL,
BRANCH_ADDRESS_STREET CHAR(30) CONSTRAINT BRANCH_ADDRESS_STREET_NN NOT NULL,
BRANCH_ADDRESS_CITY CHAR(20) CONSTRAINT BRANCH_ADDRESS_CITY_NN NOT NULL,
BRANCH_ADDRESS_COUNTRY CHAR(30) CONSTRAINT BRANCH_ADDRESS_COUNTRY_NN NOT NULL,
BRANCH_ADDRESS_POSTAL CHAR(20) CONSTRAINT BRANCH_ADDRESS_POSTAL_NN NOT NULL
);

/* CREATE TABLE EMPLOYEE */

CREATE TABLE EMPLOYEE (
EMP_NUM NUMBER CONSTRAINT EMP_NUM_PK PRIMARY KEY,
EMP_LNAME VARCHAR(25) CONSTRAINT EMP_LNAME_NN NOT NULL,
EMP_FNAME VARCHAR(25) CONSTRAINT EMP_FNAME_NN NOT NULL,
EMP_MIDDLE_NAME VARCHAR(20),
EMP_HIRE_DATE DATE CONSTRAINT EMP_HIRE_DATE_NN NOT NULL,
JOB_CODE VARCHAR(25) CONSTRAINT JOB_CODE_NN NOT NULL CONSTRAINT JOB_CODE_FK REFERENCES JOB (JOB_CODE),
BRANCH_ID VARCHAR(25) CONSTRAINT BRANCH_ID_NN NOT NULL CONSTRAINT BRANCH_ID_FK REFERENCES BRANCH (BRANCH_ID),
EMP_AGE SMALLINT CONSTRAINT EMP_AGE_NN NOT NULL CONSTRAINT EMP_AGE_RANGE_CHK CHECK(EMP_AGE >= 16 AND EMP_AGE <= 67),
EMP_GENDER VARCHAR(8) CONSTRAINT EMP_GENDER_NN NOT NULL, 
EMP_MOBILE VARCHAR(15) CONSTRAINT EMP_MOBILE_NN NOT NULL CONSTRAINT CHK_EMP_MOBILE CHECK(EMP_MOBILE NOT LIKE '%[^0-9]%'),
EMP_AREACODE CHAR(3) CONSTRAINT EMP_AREACODE_NN NOT NULL CONSTRAINT CHK_EMP_AREACODE CHECK(EMP_AREACODE NOT LIKE '%[^0-9]%'),
EMP_HOME_TEL VARCHAR(9) CONSTRAINT EMP_HOME_TEL_NN NOT NULL CONSTRAINT CHK_EMP_HOME_TEL CHECK(EMP_HOME_TEL NOT LIKE '%[^0-9]%'),
EMP_STREET_NUM VARCHAR(5) CONSTRAINT EMP_STREET_NUM_NN NOT NULL CONSTRAINT CHK_EMP_STREET_NUM CHECK(EMP_STREET_NUM NOT LIKE '%[^0-9]%'),
EMP_STREET VARCHAR(25) CONSTRAINT EMP_STREET_NN NOT NULL,
EMP_CITY VARCHAR(15) CONSTRAINT EMP_CITY_NN NOT NULL,
EMP_POSTAL_CODE VARCHAR(6) CONSTRAINT EMP_POSTAL_CODE_NN NOT NULL CONSTRAINT CHK_EMP_POSTAL_CODE CHECK(EMP_POSTAL_CODE NOT LIKE '%[^0-9]%'),
EMP_COUNTRY VARCHAR(25) CONSTRAINT EMP_COUNTRY_NN NOT NULL
);

/* CREATE TABLE EMP_SAL_HISTORY */

CREATE TABLE EMP_SAL_HISTORY (
EMP_NUM NUMBER CONSTRAINT EMP_NUM_SALARY_NN NOT NULL CONSTRAINT EMP_NUM_HISTORY_FK REFERENCES EMPLOYEE (EMP_NUM),
SALARY_START_DATE DATE CONSTRAINT SALARY_START_DATE_NN NOT NULL,
SALARY_AMT DECIMAL(6,2) CONSTRAINT SALARY_AMT_NN NOT NULL,
CONSTRAINT EMP_SAL_HISTORY_PK PRIMARY KEY(EMP_NUM,SALARY_START_DATE)
);

/* CREATE TABLE CAR */

CREATE TABLE CAR (
CAR_VIN_NUM NUMBER CONSTRAINT CAR_VIN_NUM_PK PRIMARY KEY CONSTRAINT CHK_CAR_VIN_NUM CHECK(CAR_VIN_NUM NOT LIKE '%[^0-9]%'),
EMP_NUM NUMBER CONSTRAINT EMP_NUM_NN NOT NULL CONSTRAINT EMP_NUM_FK REFERENCES EMPLOYEE (EMP_NUM),
CAR_REG_NUM VARCHAR(8) CONSTRAINT CAR_REG_NUM_NN NOT NULL CONSTRAINT CHK_CAR_REG_NUM CHECK(CAR_REG_NUM NOT LIKE '%[^0-9]%') CONSTRAINT CAR_REG_NUM_UQ UNIQUE,
CAR_MODEL VARCHAR(25) CONSTRAINT CAR_MODEL_NN NOT NULL
);

/* CREATE TABLE INSPECTION */

CREATE TABLE INSPECTION (
INSPECTION_ID SMALLINT CONSTRAINT INSPECTION_ID_PK PRIMARY KEY,
CAR_VIN_NUM NUMBER CONSTRAINT CAR_VIN_NUM_NN NOT NULL CONSTRAINT CAR_VIN_NUM_FK REFERENCES CAR (CAR_VIN_NUM),
INSPECTION_DATE DATE CONSTRAINT INSPECTION_DATE_NN NOT NULL,
MILEAGE SMALLINT CONSTRAINT MILEAGE_NN NOT NULL
);

CREATE SEQUENCE SEQ_INSPECTION_ID
START WITH 100
NOCACHE
NOCYCLE;

/* CREATE TABLE DEPARTMENT */

CREATE TABLE DEPARTMENT (
DEPARTMENT_ID VARCHAR(25) CONSTRAINT DEPARTMENT_ID_PK PRIMARY KEY,
DEPARTMENT_NAME VARCHAR(25) CONSTRAINT DEPARTMENT_NAME_NN NOT NULL,
EMP_NUM NUMBER CONSTRAINT EMP_NUM_DEPT_NN NOT NULL CONSTRAINT EMP_NUM_DEPT_FK REFERENCES EMPLOYEE (EMP_NUM),
BRANCH_ID VARCHAR(25) CONSTRAINT BRANCH_ID_DEPT_NN NOT NULL CONSTRAINT BRANCH_ID_DEPT_FK REFERENCES BRANCH (BRANCH_ID)
);

/* CREATE TABLE CLIENT */

CREATE TABLE CLIENT (
CLIENT_ID SMALLINT CONSTRAINT CLIENT_ID_PK PRIMARY KEY,
CLIENT_LNAME VARCHAR(25) CONSTRAINT CLIENT_LNAME_NN NOT NULL,
CLIENT_MIDDLE_NAME VARCHAR(20),
CLIENT_FNAME VARCHAR(25) CONSTRAINT CLIENT_FNAME_NN NOT NULL,
CLIENT_AGE SMALLINT CONSTRAINT CLIENT_AGE_NN NOT NULL CONSTRAINT CLIENT_AGE_RANGE_CHK CHECK(CLIENT_AGE >= 16 AND CLIENT_AGE <= 90),
CLIENT_GENDER VARCHAR(6) CONSTRAINT CLIENT_GENDER_NN NOT NULL, 
CLIENT_MOBILE VARCHAR(11) CONSTRAINT CLIENT_MOBILE_NN NOT NULL CONSTRAINT CHK_CLIENT_MOBILE CHECK(CLIENT_MOBILE NOT LIKE '%[^0-9]%'),
CLIENT_AREACODE CHAR(3) CONSTRAINT CLIENT_AREACODE_NN NOT NULL CONSTRAINT CHK_CLIENT_AREACODE CHECK(CLIENT_AREACODE NOT LIKE '%[^0-9]%'),
CLIENT_HOME_TEL VARCHAR(9) CONSTRAINT CLIENT_HOME_TEL_NN NOT NULL CONSTRAINT CHK_CLIENT_HOME_TEL CHECK(CLIENT_HOME_TEL NOT LIKE '%[^0-9]%'),
CLIENT_STREET_NUM VARCHAR(5) CONSTRAINT CLIENT_STREET_NUM_NN NOT NULL CONSTRAINT CHK_CLIENT_STREET_NUM CHECK(CLIENT_STREET_NUM NOT LIKE '%[^0-9]%'),
CLIENT_STREET VARCHAR(25) CONSTRAINT CLIENT_STREET_NN NOT NULL,
CLIENT_CITY VARCHAR(10) CONSTRAINT CLIENT_CITY_NN NOT NULL,
CLIENT_POSTAL_CODE VARCHAR(6) CONSTRAINT CLIENT_POSTAL_CODE_NN NOT NULL CONSTRAINT CHK_CLIENT_POSTAL_CODE CHECK(CLIENT_POSTAL_CODE NOT LIKE '%[^0-9]%'),
CLIENT_COUNTRY VARCHAR(15) CONSTRAINT CLIENT_COUNTRY_NN NOT NULL,
BRANCH_ID VARCHAR(25) CONSTRAINT BRANCH_ID_CLIENT_NN NOT NULL CONSTRAINT BRANCH_ID_CLIENT_FK REFERENCES BRANCH (BRANCH_ID)
);

CREATE SEQUENCE SEQ_CLIENT_ID
START WITH 1000
NOCACHE
NOCYCLE;

/* CREATE TABLE REGISTRATION */

CREATE TABLE REGISTRATION (
REG_NUM SMALLINT CONSTRAINT REG_NUM_PK PRIMARY KEY,
BRANCH_ID VARCHAR(25) CONSTRAINT BRANCH_ID_REG_NN NOT NULL CONSTRAINT BRANCH_ID_REG_FK REFERENCES BRANCH (BRANCH_ID),
CLIENT_ID SMALLINT CONSTRAINT CLIENT_ID_REG_NN NOT NULL CONSTRAINT CLIENT_ID_REG_FK REFERENCES CLIENT (CLIENT_ID),
REG_DATE DATE CONSTRAINT REG_DATE_NN NOT NULL
);

CREATE SEQUENCE SEQ_REG_NUM
START WITH 500
NOCACHE
NOCYCLE;

/* CREATE TABLE LESSON */

CREATE TABLE LESSON (
LESSON_ID SMALLINT CONSTRAINT LESSON_ID_PK PRIMARY KEY,
BRANCH_ID VARCHAR(25) CONSTRAINT BRANCH_ID_LESSON_NN NOT NULL CONSTRAINT BRANCH_ID_LESSON_FK REFERENCES BRANCH (BRANCH_ID),
CLIENT_ID SMALLINT CONSTRAINT CLIENT_ID_NN NOT NULL CONSTRAINT CLIENT_ID_FK REFERENCES CLIENT (CLIENT_ID),
LESSON_START_DATETIME DATE CONSTRAINT LESSON_START_TIME_NN NOT NULL,
LESSON_END_DATETIME DATE CONSTRAINT LESSON_END_TIME_NN NOT NULL,
STARTING_MILEAGE SMALLINT CONSTRAINT STARTING_MILLEAGE_NN NOT NULL,
ENDING_MILEAGE SMALLINT CONSTRAINT ENDING_MILEAGE_NN NOT NULL,
LESSON_NUM SMALLINT CONSTRAINT LESSON_NUM_NN NOT NULL,
CAR_VIN_NUM NUMBER CONSTRAINT CAR_VIN_NUM_LESSON_NN NOT NULL CONSTRAINT CAR_VIN_NUM_LESSON_FK REFERENCES CAR (CAR_VIN_NUM),
EMP_NUM NUMBER CONSTRAINT EMP_NUM_LESSON_NN NOT NULL CONSTRAINT EMP_NUM_LESSON_FK REFERENCES EMPLOYEE (EMP_NUM)
);

CREATE SEQUENCE SEQ_LESSON_ID
START WITH 9000
NOCACHE
NOCYCLE;

/* CREATE TABLE LICENSE */

CREATE TABLE LICENSE (
LICENSE_NUM NUMBER CONSTRAINT LICENSE_NUM_PK PRIMARY KEY CONSTRAINT CHK_LICENSE_NUM CHECK(LICENSE_NUM NOT LIKE '%[^0-9]%'), 
LICENSE_VERSION VARCHAR(10) CONSTRAINT LICENSE_VERSION_NN NOT NULL,
LICENSE_EXPIRY_DATE DATE CONSTRAINT LICENSE_EXPIRY_DATE_NN NOT NULL,
CLIENT_ID SMALLINT CONSTRAINT CLIENT_ID_LICENSE_NN NOT NULL CONSTRAINT CLIENT_ID_LICENSE_FK REFERENCES CLIENT (CLIENT_ID)
);

/* CREATE TABLE TEST */

CREATE TABLE TEST (
TEST_NUM VARCHAR(6) CONSTRAINT TEST_NUM_PK PRIMARY KEY CONSTRAINT CHK_TEST_NUM CHECK(TEST_NUM NOT LIKE '%[^0-9]%'),
TEST_RESULT CHAR(4) CONSTRAINT TEST_RESULT_NN NOT NULL,
TEST_ATTEMPTS SMALLINT CONSTRAINT TEST_ATTEMPTS_NN NOT NULL CONSTRAINT CHK_TEST_ATTEMPTS CHECK(TEST_ATTEMPTS NOT LIKE '%[^0-9]%'),
CLIENT_ID SMALLINT CONSTRAINT CLIENT_ID_TEST_NN NOT NULL CONSTRAINT CLIENT_ID_TEST_FK REFERENCES CLIENT (CLIENT_ID)
);

/* CREATE TABLE INTERVIEW */

CREATE TABLE INTERVIEW (
INTERVIEW_ID SMALLINT CONSTRAINT INTERVIEW_ID_PK PRIMARY KEY CONSTRAINT CHK_INTERVIEW_NUM CHECK (INTERVIEW_ID NOT LIKE '%[^0-9]%'),
EMP_NUM NUMBER CONSTRAINT EMP_NUM_INTERVIEW_NN NOT NULL CONSTRAINT EMP_NUM_INTERVIEW_FK REFERENCES EMPLOYEE (EMP_NUM),
CLIENT_ID SMALLINT CONSTRAINT CLIENT_ID_INTERVIEW_NN NOT NULL CONSTRAINT CLIENT_ID_INTERVIEW_FK REFERENCES CLIENT (CLIENT_ID),
LICENSE_NUM SMALLINT CONSTRAINT LICENSE_NUM_INTERVIEW_NN NOT NULL CONSTRAINT CHK_LICENSE_INTERVIEW_NUM CHECK (LICENSE_NUM NOT LIKE '%[^0-9]%') CONSTRAINT LICENSE_NUM_FK REFERENCES LICENSE(LICENSE_NUM),
REQUESTED_LICENSE VARCHAR(6) CONSTRAINT REQUESTED_LICENSE_NN NOT NULL
);

CREATE SEQUENCE SEQ_INTERVIEW_ID
START WITH 4000
NOCACHE
NOCYCLE;

/* CREATE TABLE INSTRUCTOR */

CREATE TABLE INSTRUCTOR (
EMP_NUM NUMBER CONSTRAINT EMP_INSTRUCTOR_NUM_NN NOT NULL CONSTRAINT EMP_INSTRUCTOR_NUM_PK PRIMARY KEY CONSTRAINT EMP_INSTRUCTOR_NUM_FK REFERENCES EMPLOYEE(EMP_NUM),
BRANCH_ID VARCHAR(10) CONSTRAINT BRANCH_INSTRUCTOR_ID_NN NOT NULL CONSTRAINT BRANCH_INSTRUCTOR_ID_FK REFERENCES BRANCH(BRANCH_ID),
CLIENT_ID SMALLINT CONSTRAINT CLIENT_INSTRUCTOR_ID_NN NOT NULL CONSTRAINT CLIENT_INSTRUCTOR_ID_FK REFERENCES CLIENT(CLIENT_ID)
);


/* CREATE TABLE MANAGER */

CREATE TABLE MANAGER (
EMP_NUM NUMBER CONSTRAINT EMP_MANAGER_NUM_NN NOT NULL CONSTRAINT EMP_MANAGER_NUM_PK PRIMARY KEY CONSTRAINT EMP_MANAGER_NUM_FK REFERENCES EMPLOYEE(EMP_NUM),
BRANCH_ID VARCHAR(10) CONSTRAINT BRANCH_MANAGER_ID_NN NOT NULL CONSTRAINT BRANCH_MANAGER_ID_FK REFERENCES BRANCH(BRANCH_ID)
);

commit;
Alter session set NLS_DATE_FORMAT = 'DD/MM/YYYY hh24:mi:ss'; 
